# 数据库知识手册

## 数据库基础概念

### 什么是数据库？

::: details answer

数据库（Database）是保存有组织的数据的容器（通常是一个文件或一组文件），是通过数据库管理系统（DataBase-Management System，DBMS）创建和操纵的容器。

::: 

### 什么是数据库管理系统？

::: details answer

一种操纵和管理数据库的大型软件，简称DBMS

::: 

### 为什么要使用数据库？

::: details answer

1. 数据可永久保存且数据安全性高
2. 使用SQL语句，查询方便效率高
3. 便于数据管理和数据分析

::: 

### SQL和MySQL有什么区别？

::: details answer

SQL是一种结构化查询语言，用于在数据库上执行各种操作。

MySQL是一个关系型数据库管理系统（RDBMS），使用SQL执行所有数据库操作。

::: 

### 数据库三大范式是什么？

::: details answer

数据库范式是设计数据库时，需要遵循的一些规范。越高的范式数据库冗余越小。常用的数据库三大范式为：

- **第一范式（1NF）：**每个列都不可以再拆分，强调列的原子性。第一范式要求数据库中的表都是二维表。
- **第二范式（2NF）：**在第一范式的基础上，一个表必须有一个主键，非主键列**完全依赖**于主键，而不能是依赖于主键的一部分。
- **第三范式（3NF）：**在第二范式的基础上，非主键列只依赖于（直接依赖）于主键，不依赖于其他非主键。

::: 

## 索引

### 索引的优缺点

::: details answer

**索引的优点**

- 通过创建**唯一性索引**，可以**保证每一行数据的唯一性**；
- 加快数据的**检索速度**
- 加速**表与表之间的连接**

**索引的缺点**

- 时间上，创建和维护索引都需要耗费时间，这种时间随数据量增加而增加
- 空间上，索引需要占**物理空间**，除了数据表占数据空间外，每个索引还要占一定的物理空间，如果要建立聚簇索引，需要的空间就更大。

::: 

### 索引的数据结构有哪些？

::: details answer

数据库索引按照结构分类，主要有**B树索引、Hash索引和位图索引**三种

**B树索引**

又称**平衡树索引**。以树结构组织，有一个或多个分支结点，分支结点又指向单级叶结点。其中分支结点用于遍历树，叶结点则保存真正的值和位置信息。

**Hash索引**

哈希索引采取一定的哈希算法（常见哈希算法有直接定址法，平方取中法，折叠法，除数取余法，随机数法），将数据库字段转换成定长的Hash值，与这条数据的行指针一并存入Hash表的对应位置，如果发生Hash冲突（两个不同关键字的Hash值相同），则在对应Hash键下以链表形式存储。

**位图索引**

位图索引为存储在某列中的每一个值生成一个位图。位图索引适合只有几个固定值的列，需要注意位图索引适合静态数据，不适合索引频繁更新的列。

::: 

### B树的特点

::: details answer

![](https://cdn.jsdelivr.net/gh/River-Cold/pictureBed/vuepress-blog/interview/basics/network/20220227215631.png)

B树是所有结点的平衡因子均等于0的多路平衡查找树

- 每个节点最多m个子结点（m棵子树），即**至多含有$m-1$个关键字**
- 如果根节点没有关键字就没有子树，此时B树为空；如果根节点有关键字，则其子树必然大于等于两棵
- 除了根节点和叶子结点外，每个结点至少有$\lceil{m/2\rceil}$（向上取整）个子结点
- 所有叶子结点位于同一层，按照关键字大小顺序排列
- 每个节点既存放关键字信息也存放具体数据

:::

### B+树的特点

::: details answer

B+ 树是在 B 树基础上的一种优化，使其更适合实现存储索引结构。

![](https://cdn.jsdelivr.net/gh/River-Cold/pictureBed/vuepress-blog/interview/basics/network/20220227215703.png)

- 每个节点最多m个子结点（m棵子树），即**至多含有$m$个关键字**
- 如果根节点没有关键字就没有子树，此时B树为空；如果根节点有关键字，则其子树必然大于等于两棵
- 除了根节点和叶子结点外，每个结点至少有$\lceil{m/2\rceil}$（向上取整）个子结点
- 所有叶子结点位于同一层，按照关键字大小顺序排列，**并且相邻叶结点之间有一个链指针**
- 非叶结点只起到索引作用，只存放关键字，不存放数据，只有叶子结点既存放关键字也存放数据

:::

### B+树和B-树的区别？

::: details answer

- B树每个节点的子节点个数=关键字个数+1，B+树每个节点的子节点个数=关键字个数
- B树的相邻叶结点都是独立的，B+树的相邻叶结点之间有链指针
- B树的每个节点既存放关键字也存放数据，B+树的非叶结点只起到索引作用，只存放关键字，不存放数据，只有叶子结点既存放关键字也存放数据

:::

### 使用B+树的好处?

::: details answer

**更少的IO次数**：B+树的内部结点只存放键，不存放值，因此，一次读取，可以在同一内存页中获取更多的键，有利于更快的缩小查找范围。

**更适用于范围查询：**B+树的叶结点由一条链相连，因此当需要进行一次**全数据遍历**的时候，B+树只需要使用$O(logN)$时间找到最小结点，然后通过链进行$O(N)$的顺序遍历即可。或者在找**大于某个关键字或者小于某个关键字的数据**的时候，B+树只需要找到该关键字然后沿着链表遍历即可。

::: 

### Hash索引和B+树索引的区别？

::: details answer

- **范围查询：**Hash索引不支持范围查询，B+树支持范围查询
- **排序：**Hash索引不支持排序，B+树索引支持排序，因为Hash索引指向的数据是无序的，而B+树索引指向的数据是有序的
- **模糊查询和最左前缀匹配：**Hash索引不支持模糊查询以及多列索引的最左前缀匹配，原因是Hash函数的不可预测，AAAA和AAAAB的索引没有相关性，B+树索引支持模糊查询以及多列索引的最左前缀匹配
- **查询效率：**Hash索引虽然在等值查询上较快，但是不稳定，当某个键值存在大量重复的时候，发生Hash碰撞，此时效率可能极差；B+树的查询效率比较稳定，对于所有的查询都是从根节点到叶子结点，且树的高度较低

:::

### 什么是前缀索引？

::: details answer

有时需要索引很长的字符列，它会使索引变大且变慢，一个策略就是使用索引开始的几个字符，而不是全部值，即被称为**前缀索引**，以节约空间并获得好的性能。

:::

### 什么是联合索引？

::: details answer

联合索引就是由两个或以上的字段共同构成的索引。

:::

### 什么是最左前缀匹配原则？

::: details answer

在MySQL建立联合索引（多列索引）时会遵循最左前缀匹配原则，即**最左优先**，在检索数据时从联合索引的最左边一列开始匹配（也就是where子句中一定要有联合索引的第一个字段，并且where子句中字段的顺序可以任意调整）。

例如有一个3列索引（a,b,c），则已经对(a)、(a,b)、(a,b,c)上建立了索引。所以在创建**多列索引**时，要根据业务需求，`where`子句中使用最频繁的一列放在最左边。

**根据最左前缀匹配原则，MySQL 会一直向右匹配直到遇到 范围查询（>、<、between、like）就停止匹配，**比如采用查询条件 where a = 1 and b = 2 and c > 3 and d = 4 时，如果建立（a,b,c,d）顺序的索引，d 是用不到索引的，如果建立（a,b,d,c）的索引则都可以用到，并且 where 子句中 a、b、d 的顺序可以任意调整。

:::

### 添加索引的原则

::: details answer

- **在查询中很少使用或者参考的列不要创建索引：**由于这些列很少使用到，增加索引反而会降低系统的维护速度和增大空间需求。
- **只有很少数据值的列不创建索引：**区分度太低，增加索引并不能明显加快检索速度
- **修改性能远远大于检索性能时，不应该创建索引**：二者相互矛盾，当增加索引时，会提高索引性能，但是会降低修改性能。
- **定义为外键的数据列一定要创建索引**：如果不加索引，则删除主表记录或主子表关联查询，都会进行字表的全表扫描。

:::

